앱 분석을 어렵게 만들어서 공격자로부터 앱을 보호하려는 목적

<br>

## Android Mobile Solution💡

- **Rooting 탐지** : 루팅된 기기에서 앱이 실행되면 스스로 종료
- App 무결성 검증 : 이용자가 변조된 앱을 사용하지 않도록
- 안티 디버깅
- 난독화

<br>

### Rooting 탐지

루팅을 한 기기에서의 특징을 체크해 루팅을 탐지

- 루팅 시 생성되는 **패키지** 검사
- **루팅된 기기에 존재하는 File** 체크
- 루팅 시 변할 수 있는 **build.prop** 파일 체크
- 디렉토리 권한 확인 (system directory권한을 변경했는지)

<br>

### Detection Bypass

- **코드패치** : 바이너리, smali 변조 후 리패키징. 이게 편하긴 하나 리패키징 과정에서 방해하는 솔루션들이 있음
- **함수 후킹** : 탐지 로직 함수를 후킹해 우회

<br>

## 무결성 검증

App 바이너리, 리소스가 변조되었는지 확인

목적 - 악의적으로 수정된 앱의 이용을 제한하기 위해

검증방법 - 원본 앱의 HASH값 비교. **DEX파일**을 함호화 후 저장해둔 뒤, App실행시 해당 파일을 복호화해서 로딩 

<br>

무결성 검증을 서버에서 하냐 클라이언트에서 하냐에 따라 우회방법이 다르다

- SERVER : 앱 서버에서 전달되는 Hash 변조. 앱 서버에서 온 결과 변조 (Burp사용)
- CLIENT : 함수 후킹. 동적 로딩 시 변조된 DEX파일로 교채해서 로딩되도록

<br>

## 안티 디버깅

디버거가 attach 하는 것을 막음

디버거의 존재를 확인하고 해당 프로세스가 동작하지 못하게 함 

- `시간 기반 탐지` : **두 명령(어셈블리어) 사이에 실행 시간**이 일정 시간보다 크면 디버깅 중인 것으로 판단
- `파일 기반 탐지` : TracerPid가 0이 아닐 경우. (디버깅 중이면 PID가 변경되기때문)
- `VM 필드를 이용한 탐지`
- **`ptrace를 이용한 안티디버깅` : ptrace 함수를 이용해 해당 프로세스 디버깅을 선점하는 방법**
- `BP Scan` : 현재 코드영역에 **BP**가 되어있는지 스캔

<br>

## SSL Pinning

SSL/TLS 통신할 때 사용하는 인증서를 **앱 서버의 인증서로 고정** 

목적 - MITM 공격 방지. 취약점 찾기 힘들게 

우회 ⇒ Frida 이용 (인터넷에 잘 나옴)
